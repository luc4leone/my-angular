<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  </head>
  <body></body>
  <script src="lodash.js"></script>
  <script>
'use strict';

// to make first value of scope.last unique, hence always detect a change
function initWatchVal() {}

// `scope` obj
var scope = {}

// to add a watcher
scope.$watch = function(watchFn, listenerFn) {
  var watcher = {
    watchFn: watchFn,
    listenerFn: listenerFn,
    last: initWatchVal
  }
  this.$$watchers.push(watcher)
}

// where I store a watcher 
scope.$$watchers = []

// dirty checking
scope.$digest = function() {
  var newValue, oldValue;
  _.forEach(this.$$watchers,function(watcher) {
    newValue = watcher.watchFn();
    oldValue = watcher.last;
    if (newValue != oldValue) {
      watcher.last = newValue;
      watcher.listenerFn(newValue, oldValue, this)
    }
  })
}

/* PLAY IN THE CONSOLE

  scope.name = 'luca';

  scope.$watch(
    function(){return scope.name}, 
    function(){console.log(scope.name, 'leone')});

  scope.$digest();

  scope.name = 'jack';

  scope.$digest();

*/
</script>
</html>